# Новые функции, добавленные из wg-easy

## Версия 2.0.0

Это обновление добавляет множество новых функций из проекта wg-easy в awg-easy, сохраняя при этом поддержку Amnezia WireGuard параметров.

### Новые API эндпоинты

1. **Получение информации о релизе**
   - `GET /api/information` - возвращает текущую версию, последнюю версию и наличие обновлений
   - `GET /api/wireguard/client/:clientId` - получение информации о конкретном клиенте
   - `GET /api/wireguard/client/:clientName?byName=true` - получение информации по имени клиента

2. **QR-коды**
   - `GET /api/wireguard/client/:clientId/qrcode.svg` - QR-код в формате SVG
   - `GET /api/wireguard/client/:clientName/qrcode.svg?byName=true` - QR-код SVG по имени
   - `GET /api/wireguard/client/:clientId/qrcode.png` - QR-код в формате PNG (новый)
   - `GET /api/wireguard/client/:clientName/qrcode.png?byName=true` - QR-код PNG по имени

3. **Работа с клиентами по имени (НОВОЕ)**
   - Все операции с клиентами теперь поддерживают работу по имени через параметр `?byName=true`
   - Включить/выключить клиента по имени
   - Обновить параметры клиента по имени
   - Скачать конфигурацию по имени
   - Удалить клиента по имени
   - Получить QR-код по имени

3. **Статистика**
   - `GET /api/wireguard/statistics` - общая статистика по всем клиентам:
     - Всего клиентов
     - Включенных клиентов
     - Активных клиентов (подключались в последние 10 минут)
     - Общий трафик (загрузка/выгрузка)

4. **Поиск и фильтрация**
   - `GET /api/wireguard/client?filter=<query>` - поиск клиентов по имени, адресу или ID

5. **Массовые операции**
   - `POST /api/wireguard/client/enable-all` - включить всех клиентов
   - `POST /api/wireguard/client/disable-all` - отключить всех клиентов

6. **Экспорт**
   - `GET /api/wireguard/export` - экспорт всех конфигураций в JSON формате

### Улучшения UI

1. **Поле поиска**
   - Добавлено поле поиска клиентов в реальном времени
   - Поиск по имени, IP-адресу и ID клиента
   - Отображение сообщения, если ничего не найдено

2. **Статистика**
   - Отображение статистики над списком клиентов:
     - Всего клиентов
     - Включенных клиентов
     - Активных клиентов (онлайн)
     - Общий трафик (загрузка/выгрузка)

3. **Улучшенная локализация**
   - Добавлены новые строки перевода на русский и английский языки:
     - "Поиск..."
     - "Клиенты не найдены"
     - "Всего", "Включено", "Активно"
     - "Включить всех клиентов?"
     - "Выключить всех клиентов?"

### Улучшения в коде

1. **Утилиты**
   - Добавлена валидация IPv6
   - Улучшена функция очистки имён файлов
   - Добавлена функция поиска клиентов

2. **WireGuard модуль**
   - Добавлена функция экспорта всех конфигураций
   - Добавлена функция массового включения/отключения клиентов
   - Улучшена генерация QR-кодов с настройками коррекции ошибок
   - Добавлена функция поиска клиентов

3. **Обновление зависимостей**
   - Express обновлён до 4.21.2
   - QRCode обновлён до 1.5.4
   - UUID обновлён до 11.0.3
   - Добавлен semver для управления версиями
   - Tailwind CSS обновлён до 3.4.18
   - Добавлен nodemon в dev зависимости

### Сохранённые функции Amnezia WireGuard

Все специфичные для Amnezia WireGuard параметры сохранены:
- Jc, Jmin, Jmax
- S1, S2
- H1, H2, H3, H4

Эти параметры автоматически генерируются при создании сервера и включаются в конфигурацию каждого клиента.

### Обратная совместимость

Все старые эндпоинты и функции сохранены. Новый код полностью совместим с предыдущей версией.

### Установка обновлений

Для использования новых функций выполните:

```bash
cd src
npm install
```

Затем перезапустите контейнер Docker или сервер.

### Известные ограничения

1. База данных всё ещё использует JSON файл вместо SQLite (как в новой версии wg-easy)
2. Нет системы пользователей и ролей (планируется в будущих версиях)
3. Нет 2FA аутентификации (планируется в будущих версиях)
4. Нет одноразовых ссылок для конфигураций (планируется в будущих версиях)
5. Нет CLI утилиты (планируется в будущих версиях)

### Будущие планы

- Миграция на TypeScript
- Добавление Nuxt 3 для фронтенда
- Добавление Drizzle ORM и SQLite
- Система пользователей и ролей
- 2FA аутентификация
- CLI утилита для управления
- Одноразовые ссылки для конфигураций
- WebSocket для real-time обновлений
